import{u as w,j as e}from"./index-BzRYe7T0.js";import{b as _,c as I,d as S,a as P}from"./firebase-DMO3EB_U.js";import{u as R,P as j}from"./pendingPage-C_TOwlca.js";import{a as g}from"./firebaseFunctions-B7adSngD.js";import{B as A}from"./button-cc73kDZo.js";import{C as E,a as m,b as f}from"./card-TTWbz8aG.js";import"./index-B17J8msL.js";import"./table-B8AocDf4.js";import"./index.esm2017-BAAKErde.js";var l;let p=null;const y={jsSdkUrl:(l=void 0)!==null&&l!==void 0?l:"https://cdn.portone.io/v2/browser-sdk.js"};function O(){return document.querySelector(`script[src="${y.jsSdkUrl}"]`)}function x(){const n=document.createElement("script");n.src=y.jsSdkUrl;const r=document.head||document.body;if(!r)throw new Error("[PortOne] Expected document.body not to be null");return r.appendChild(n)}function D(){return p??(p=new Promise((n,r)=>{if(window.PortOne)return n(window.PortOne);try{const t=O()||x();t.addEventListener("load",()=>{if(window.PortOne)return n(window.PortOne);r(new Error("[PortOne] Failed to load window.PortOne"))}),t.addEventListener("error",()=>{r(new Error("[PortOne] Failed to load window.PortOne"))})}catch(t){return r(t)}}))}function T(n){return D().then(r=>r.requestPayment(n))}var h={VITE_FIREBASE_API_KEY:"AIzaSyBZxNityRiq342MPO8hcCEG1ZWHWw-HGD8",VITE_FIREBASE_AUTH_DOMAIN:"testproject-83faf.firebaseapp.com",VITE_FIREBASE_PROJECT_ID:"testproject-83faf",VITE_FIREBASE_STORAGE_BUCKET:"testproject-83faf.appspot.com",VITE_FIREBASE_MESSAGING_SENDER_ID:"411886403718",VITE_FIREBASE_APP_ID:"1:411886403718:web:5d576576f664a89fa41107",VITE_FIREBASE_MEASUREMENT_ID:"G-223ZXCS6RB",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};async function C({orderName:n,totalAmount:r}){try{const t=await T({storeId:h.VITE_PORTONE_API_KEY,paymentId:`payment-${crypto.randomUUID()}`,orderName:n,totalAmount:r,currency:"CURRENCY_KRW",channelKey:h.VITE_PORTONE_CHANNEL_KEY,payMethod:"CARD"});if(t&&t.code==="success")return t;throw console.log(t),new Error("결재 실패")}catch(t){throw console.error("결제 요청 중 오류 발생:",t),t}}async function N({sellerId:n,buyerId:r,productQuantity:t,Status:c,id:d,...o}){try{const a=await _(I(S,"ORDER"),{sellerId:n,buyerId:r,id:d,productQuantity:t,Status:c,...o,createdAt:new Date,updatedAt:new Date});return console.log("Document written with ID: ",a.id),a.id}catch(a){console.error("Error adding document: ",a)}}const B=()=>{const{data:n}=R("shoppingList",()=>{var o;return g(((o=P.currentUser)==null?void 0:o.uid)||"")}),r=w(),t=o=>{const a=o.getFullYear(),s=(o.getMonth()+1).toString().padStart(2,"0"),i=o.getDate().toString().padStart(2,"0");return`${a}${s}${i}`},c=o=>{if(!o||o.length<1){console.error("상품이 없습니다");return}d(o)},d=async o=>{var a;for(const s of o){const i=`${t(new Date)}_order_${crypto.getRandomValues(new Uint32Array(1))[0]}`;console.log(typeof s.quantity,typeof s.productPrice);const u=await C({orderName:i,totalAmount:s.quantity*s.productPrice});if(u instanceof Error){console.error("결재 실패");return}u.code==="success"&&N({sellerId:s.sellerId.toString(),buyerId:s.owner?s.owner.toString():"",productId:s.id?s.id.toString():"",productQuantity:s.productQuantity,Status:"주문 완료",id:((a=u.paymentId)==null?void 0:a.toString())||""}).then(()=>{console.log("주문 완료"),r("/order")})}};return e.jsx("div",{children:e.jsx(A,{onClick:()=>c(n),children:"결제하기"})})},K=()=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{className:"w-4/5",children:e.jsxs(E,{children:[e.jsx(m,{children:e.jsx("h1",{children:"주문 확인"})}),e.jsx(f,{children:e.jsx(j,{})})]})}),e.jsx("div",{className:"w-1/5",children:e.jsxs(E,{children:[e.jsx(m,{children:e.jsx("h1",{children:"결제(TossPayment)"})}),e.jsx(f,{children:e.jsx(B,{})})]})})]});export{K as default};
